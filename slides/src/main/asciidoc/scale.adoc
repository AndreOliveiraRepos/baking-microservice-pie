ifndef::imagesdir[:imagesdir: images]

= Scaling

[%step]
* We need to scale our microservices
* Several Number Generators
* Deployed on several Pis
* Which instance to choose from?

== Architecture

image::scale-architecture.png[]

== Client-Side Load Balancing

[%step]
* The client picks from among the registered instances of a given service
* Then choose from among the candidate instances
* Following certain criterias
* Capacity, round-robin, cloud-provider availability-zone awareness, multi-tenancy

== Several to choose from

[%step]
* Amazon Elastic Load Balancing (ELB)
* Netflix Ribbon

== What is Ribbon?

[%step]
* Netflix implementation of Client-Side Load Balancing
* Integrates with Feign using `HystrixFeign`

== Register several Number APIs in Consul

[source,java,indent=0]
----
include::{demo07numberapidir}/src/main/java/org/bakingpie/number/rest/ConsulManagementService.java[tags=adocSnippet]
----

== Book API Registers the Ribbon Load-balancer

[source,java,indent=0]
----
include::{demo07bookapidir}/src/main/java/org/bakingpie/book/rest/ConsulManagementService.java[tags=adocSnippet]
----

== Book API Load-balances with Feign

[source,java]
----
include::{demo07bookapidir}/src/main/java/org/bakingpie/book/client/ApiClient.java[tags=adocSnippet]
----

== Demo

image::scale-architecture.png[]

== What's next ?

[%step]
* Securing micro-services
* Adding a security token
